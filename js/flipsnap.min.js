/*

 flipsnap.js

 @version  0.2.1
 @url http://pxgrid.github.com/js-flipsnap/

 Copyright 2011 PixelGrid, Inc.
 Licensed under the MIT License:
 http://www.opensource.org/licenses/mit-license.php
*/
(function(w,j,i){var k,f,o,p,h;function e(a,b){return this instanceof e?this.init(a,b):new e(a,b)}function x(a){return k?"translate3d("+a+"px, 0, 0)":"translate("+a+"px, 0)"}function l(a,b){return f?a.changedTouches[0][b]:a[b]}function q(a){return r(a,function(a){return s.style[a]!==i})}function z(a,b,d){var c=m[b];c?a[c]=d:a[b]!==i?(m[b]=b,a[b]=d):r(y,function(c){c=n(c)+n(b);if(a[c]!==i)return m[b]=c,a[c]=d,!0})}function A(a){if(s.style[a]!==i)return a;var b;r(y,function(d){var c=n(d)+n(a);if(s.style[c]!==
i)return b="-"+d+"-"+a,!0});return b}function n(a){return a.charAt(0).toUpperCase()+a.substr(1)}function r(a,b){for(var d=0,c=a.length;d<c;d++)if(b(a[d],d))return!0;return!1}var s=j.createElement("div"),y=["webkit","moz","o","ms"],m={};k=void 0;f=void 0;o=void 0;p=void 0;h=void 0;k=q(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]);o=q(["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"]);p=q(["transitionProperty","WebkitTransitionProperty",
"MozTransitionProperty","OTransitionProperty","msTransitionProperty"]);f="ontouchstart"in w;h=(k||o)&&p;var t=f?"touchstart":"mousedown",u=f?"touchmove":"mousemove",v=f?"touchend":"mouseup";e.prototype.init=function(a,b){this.element=a;if("string"===typeof a)this.element=j.querySelector(a);h?this._setStyle({transitionProperty:A("transform"),transitionTimingFunction:"cubic-bezier(0,0,0.25,1)",transitionDuration:"0ms",transform:x(0)}):this._setStyle({position:"relative",left:"0px"});this.conf=b||{};
this.currentX=this.currentPoint=0;this.animation=!1;this.refresh();this.element.addEventListener(t,this,!1);this.element.addEventListener(u,this,!1);this.element.addEventListener(v,this,!1);return this};e.prototype.handleEvent=function(a){switch(a.type){case t:this._touchStart(a);break;case u:this._touchMove(a);break;case v:this._touchEnd(a);break;case "click":this._click(a)}};e.prototype.refresh=function(){var a;if(!(a=this.conf.maxPoint))if(!(a=this.conf.point)){a=this.element.childNodes;for(var b=
0,d=0,c=a.length,e;d<c;d++)e=a[d],1===e.nodeType&&b++;0<b&&b--;a=b}this.maxPoint=a;this.distance=this.conf.distance||this.element.scrollWidth/(this.maxPoint+1);this.maxX=-this.distance*this.maxPoint;this.moveToPoint(this.currentPoint,!0)};e.prototype.hasNext=function(){return this.currentPoint<this.maxPoint};e.prototype.hasPrev=function(){return 0<this.currentPoint};e.prototype.toNext=function(){this.hasNext()&&this.moveToPoint(this.currentPoint+1)};e.prototype.toPrev=function(){this.hasPrev()&&this.moveToPoint(this.currentPoint-
1)};e.prototype.moveToPoint=function(a,b){this.currentPoint=0>a?0:a>this.maxPoint?this.maxPoint:parseInt(a);h?this._setStyle({transitionDuration:"350ms"}):this.animation=!0;this._setX(-this.currentPoint*this.distance);if(!b){var d=this.element,c=j.createEvent("Event");c.initEvent("fsmoveend",!0,!1);d.dispatchEvent(c);d=this.element;c=j.createEvent("Event");c.initEvent("flipsnap.moveend",!0,!1);d.dispatchEvent(c)}};e.prototype._setX=function(a){this.currentX=a;h?this.element.style[m.transform]=x(a):
this.animation?this._animate(a):this.element.style.left=a+"px"};e.prototype._touchStart=function(a){if(!this.conf.touchDisable)h?this._setStyle({transitionDuration:"0ms"}):this.animation=!1,this.scrolling=!0,this.moveReady=!1,this.startPageX=l(a,"pageX"),this.startPageY=l(a,"pageY"),this.basePageX=this.startPageX,this.directionX=0,this.startTime=a.timeStamp};e.prototype._touchMove=function(a){if(this.scrolling){var b=l(a,"pageX"),d=l(a,"pageY"),c;if(this.moveReady){a.preventDefault();a.stopPropagation();
a=b-this.basePageX;c=this.currentX+a;if(0<=c||c<this.maxX)c=Math.round(this.currentX+a/3);this._setX(c);this.directionX=0===a?this.directionX:0<a?-1:1}else if(c=Math.abs(b-this.startPageX),d=Math.abs(d-this.startPageY),5<c)a.preventDefault(),a.stopPropagation(),this.moveReady=!0,this.element.addEventListener("click",this,!0);else if(5<d)this.scrolling=!1;this.basePageX=b}};e.prototype._touchEnd=function(){var a=this;if(a.scrolling){a.scrolling=!1;var b=-a.currentX/a.distance,b=0<a.directionX?Math.ceil(b):
0>a.directionX?Math.floor(b):Math.round(b);a.moveToPoint(b);setTimeout(function(){a.element.removeEventListener("click",a,!0)},200)}};e.prototype._click=function(a){a.stopPropagation();a.preventDefault()};e.prototype._setStyle=function(a){var b=this.element.style,d;for(d in a)z(b,d,a[d])};e.prototype._animate=function(a){var b=this.element,d=+new Date,c=parseInt(b.style.left),e=setInterval(function(){var g=new Date-d;if(350<g)clearInterval(e),g=a;else var f=g,g=-(f/=350)*(f-2),g=g*(a-c)+c;b.style.left=
g+"px"},10)};e.prototype.destroy=function(){this.element.removeEventListener(t,this);this.element.removeEventListener(u,this);this.element.removeEventListener(v,this)};w.Flipsnap=e})(window,window.document);
